var f=Object.defineProperty;var O=(c,e,s)=>e in c?f(c,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[e]=s;var l=(c,e,s)=>(O(c,typeof e!="symbol"?e+"":e,s),s);import{_ as m}from"./preload-helper.a4192956.js";import{g as E,P as R}from"./paths.f059e082.js";const _=!0,y=_,g="/geoml-hub-backend";class p extends Error{constructor(e,s,t,r=null,a=null){super(e),this.name="ApiError",this.code=s,this.status=t,this.context=r,this.requestId=a}}const n={INTERNAL_SERVER_ERROR:"INTERNAL_SERVER_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",AUTHENTICATION_ERROR:"AUTHENTICATION_ERROR",AUTHORIZATION_ERROR:"AUTHORIZATION_ERROR",NOT_FOUND:"NOT_FOUND",CONFLICT:"CONFLICT",BAD_REQUEST:"BAD_REQUEST",REPOSITORY_NOT_FOUND:"REPOSITORY_NOT_FOUND",REPOSITORY_ALREADY_EXISTS:"REPOSITORY_ALREADY_EXISTS",REPOSITORY_CREATE_FAILED:"REPOSITORY_CREATE_FAILED",INVALID_REPOSITORY_NAME:"INVALID_REPOSITORY_NAME",FILE_NOT_FOUND:"FILE_NOT_FOUND",FILE_UPLOAD_FAILED:"FILE_UPLOAD_FAILED",INVALID_FILE_TYPE:"INVALID_FILE_TYPE",FILE_TOO_LARGE:"FILE_TOO_LARGE",USER_NOT_FOUND:"USER_NOT_FOUND",INVALID_CREDENTIALS:"INVALID_CREDENTIALS",USER_ALREADY_EXISTS:"USER_ALREADY_EXISTS",STORAGE_ERROR:"STORAGE_ERROR",EXTERNAL_SERVICE_ERROR:"EXTERNAL_SERVICE_ERROR",DATABASE_ERROR:"DATABASE_ERROR",DUPLICATE_RESOURCE:"DUPLICATE_RESOURCE",FOREIGN_KEY_VIOLATION:"FOREIGN_KEY_VIOLATION"},$={[n.INTERNAL_SERVER_ERROR]:"服务器内部错误，请稍后重试",[n.VALIDATION_ERROR]:"输入数据格式错误，请检查后重试",[n.AUTHENTICATION_ERROR]:"需要登录才能进行此操作",[n.AUTHORIZATION_ERROR]:"您没有权限进行此操作",[n.NOT_FOUND]:"请求的资源不存在",[n.CONFLICT]:"操作冲突，请刷新页面后重试",[n.BAD_REQUEST]:"请求参数错误",[n.REPOSITORY_NOT_FOUND]:"仓库不存在",[n.REPOSITORY_ALREADY_EXISTS]:"仓库名已存在",[n.REPOSITORY_CREATE_FAILED]:"创建仓库失败",[n.INVALID_REPOSITORY_NAME]:"仓库名格式错误",[n.FILE_NOT_FOUND]:"文件不存在",[n.FILE_UPLOAD_FAILED]:"文件上传失败",[n.INVALID_FILE_TYPE]:"不支持的文件类型",[n.FILE_TOO_LARGE]:"文件过大",[n.USER_NOT_FOUND]:"用户不存在",[n.INVALID_CREDENTIALS]:"用户名或密码错误",[n.USER_ALREADY_EXISTS]:"用户已存在",[n.STORAGE_ERROR]:"存储服务错误",[n.EXTERNAL_SERVICE_ERROR]:"外部服务暂时不可用",[n.DATABASE_ERROR]:"数据库操作失败",[n.DUPLICATE_RESOURCE]:"资源已存在",[n.FOREIGN_KEY_VIOLATION]:"引用的资源不存在"};function S(c){if(c instanceof p)return c;if(c.response){const e=c.response,s=e.data||{};if(s.error)return new p(s.error.message,s.error.code,e.status,s.error.context,s.request_id);const t=s.detail||s.message||`HTTP ${e.status}`,r=I(e.status);return new p(t,r,e.status)}return c.message?new p(c.message,n.INTERNAL_SERVER_ERROR,0):new p("未知错误，请稍后重试",n.INTERNAL_SERVER_ERROR,0)}function A(c){const e=S(c);return e.message&&e.message!==e.code?e.message:$[e.code]||"未知错误，请稍后重试"}function I(c){return{400:n.BAD_REQUEST,401:n.AUTHENTICATION_ERROR,403:n.AUTHORIZATION_ERROR,404:n.NOT_FOUND,409:n.CONFLICT,422:n.VALIDATION_ERROR,500:n.INTERNAL_SERVER_ERROR}[c]||n.INTERNAL_SERVER_ERROR}class T{static handleApiError(e,s={}){const{showNotification:t=!0,logError:r=!0}=s,a=S(e);return r&&console.error("API Error:",{message:a.message,code:a.code,status:a.status,context:a.context,requestId:a.requestId}),t&&typeof window<"u"&&console.warn("Error notification:",A(a)),a}static handleValidationError(e){var t;const s={};return e.code===n.VALIDATION_ERROR&&((t=e.context)!=null&&t.validation_errors)&&e.context.validation_errors.forEach(r=>{s[r.field]=r.message}),s}static needsReauth(e){return e.code===n.AUTHENTICATION_ERROR}static shouldRetry(e){return e.status>=500||e.status===0}}const q=g;class L{constructor(){l(this,"repositories",{addClassification:async(e,s,t)=>this.request(`/api/repositories/${e}/${s}/classifications?classification_id=${t}`,{method:"POST"}),removeClassifications:async(e,s)=>this.request(`/api/repositories/${e}/${s}/classifications`,{method:"DELETE"}),addTaskClassification:async(e,s,t)=>this.request(`/api/repositories/${e}/${s}/task-classifications?task_classification_id=${t}`,{method:"POST"}),removeTaskClassification:async(e,s,t)=>this.request(`/api/repositories/${e}/${s}/task-classifications/${t}`,{method:"DELETE"}),getTaskClassifications:async(e,s)=>this.request(`/api/repositories/${e}/${s}/task-classifications`)});this.baseUrl=q}getToken(){return localStorage.getItem("authToken")}setToken(e){e?localStorage.setItem("authToken",e):localStorage.removeItem("authToken")}clearToken(){localStorage.removeItem("authToken"),localStorage.removeItem("user"),localStorage.removeItem("refreshToken")}async handleTokenExpired(){try{const{refreshTokenSilently:e}=await m(()=>import("./auth.36f9ee17.js"),["./auth.36f9ee17.js","./preload-helper.a4192956.js","./scheduler.cc6cbc02.js","./auth.9aaca404.js","./singletons.434e14c9.js","./paths.f059e082.js"],import.meta.url);return await e()}catch(e){return console.error("Failed to handle token expiration:",e),{success:!1,error:e.message}}}async request(e,s={}){var u;const t=`${this.baseUrl}${e}`,r={headers:{...s.headers},...s};r.body instanceof FormData||(r.headers["Content-Type"]="application/json");const a=this.getToken();a&&(r.headers.Authorization=`Bearer ${a}`),r.body&&typeof r.body=="object"&&!(r.body instanceof FormData)&&(r.body=JSON.stringify(r.body));try{const i=await fetch(t,r);if(i.status===401)if((await this.handleTokenExpired()).success){const o={...r,headers:{...r.headers,Authorization:`Bearer ${localStorage.getItem("authToken")}`}};return await fetch(t,o)}else{if(this.clearToken(),y){const{logout:d}=await m(()=>import("./auth.9aaca404.js"),["./auth.9aaca404.js","./preload-helper.a4192956.js","./singletons.434e14c9.js","./scheduler.cc6cbc02.js"],import.meta.url);d(),E(R.LOGIN)}const o=new Error("Authentication required");throw o.response={status:401,data:{}},o}if(!i.ok){const h=await i.json().catch(()=>({})),o=new Error(((u=h.error)==null?void 0:u.message)||h.message||`HTTP ${i.status}`);throw o.response={status:i.status,data:h},o}return await i.json()}catch(i){const h=T.handleApiError(i,{showNotification:!1,logError:!0});throw T.needsReauth(h)&&(this.clearToken(),E(R.LOGIN)),h}}async uploadFile(e,s,t=null){const r=new FormData;return r.append("file",s),this.uploadFormData(e,r,t)}async uploadFormData(e,s,t=null){const r=`${this.baseUrl}${e}`;return new Promise((a,u)=>{const i=new XMLHttpRequest;t&&typeof t=="function"&&i.upload.addEventListener("progress",o=>{if(o.lengthComputable){const d=Math.round(o.loaded/o.total*100);t(d)}}),i.onload=async()=>{try{if(i.status===401){if((await this.handleTokenExpired()).success)console.log("Token refreshed, please retry your upload"),u(new Error("Token was refreshed, please retry the upload"));else{if(y){localStorage.removeItem("authToken"),localStorage.removeItem("user"),localStorage.removeItem("refreshToken");const{logout:d}=await m(()=>import("./auth.9aaca404.js"),["./auth.9aaca404.js","./preload-helper.a4192956.js","./singletons.434e14c9.js","./scheduler.cc6cbc02.js"],import.meta.url);d(),E(R.LOGIN)}u(new Error("Authentication required"))}return}if(i.status>=200&&i.status<300)try{const o=JSON.parse(i.responseText);a({success:!0,data:o,status:i.status})}catch{a({success:!0,data:{content:i.responseText},status:i.status})}else{let o;try{o=JSON.parse(i.responseText)}catch{o={message:i.statusText}}a({success:!1,error:(o==null?void 0:o.detail)||(o==null?void 0:o.message)||`HTTP ${i.status}`,status:i.status})}}catch(o){a({success:!1,error:o.message||"请求失败",status:i.status})}},i.onerror=()=>{a({success:!1,error:"网络错误，请检查连接",status:0})},i.ontimeout=()=>{a({success:!1,error:"请求超时",status:0})},i.open("POST",r),i.timeout=3e5;const h=this.getToken();h&&i.setRequestHeader("Authorization",`Bearer ${h}`),i.send(s)})}async mockExternalAuth(e,s){try{return{success:!0,data:await this.request("/api/auth/mock-external-auth",{method:"POST",body:{email:e,password:s}})}}catch(t){return{success:!1,error:t.message}}}async login(e){try{const s=await this.request("/api/auth/login",{method:"POST",body:{external_token:e}});return s.access_token&&this.setToken(s.access_token),{success:!0,data:s}}catch(s){return{success:!1,error:s.message}}}async register(e,s,t=null,r=null){try{const a=await this.request("/api/auth/register",{method:"POST",body:{email:e,password:s,username:t,full_name:r}});return a.access_token&&this.setToken(a.access_token),{success:!0,data:a}}catch(a){return{success:!1,error:a.message}}}async loginWithCredentials(e,s){try{const t=await this.request("/api/auth/login/credentials",{method:"POST",body:{email:e,password:s}});return t.access_token&&this.setToken(t.access_token),{success:!0,data:t}}catch(t){return{success:!1,error:t.message}}}async verify(){try{return{success:!0,data:await this.request("/api/auth/verify",{method:"POST"})}}catch(e){return{success:!1,error:e.message}}}async logout(){try{return await this.request("/api/auth/logout",{method:"POST",body:{token:this.getToken()}}),this.clearToken(),{success:!0}}catch(e){return this.clearToken(),{success:!1,error:e.message}}}async getCurrentUser(){try{return{success:!0,data:await this.request("/api/auth/me")}}catch(e){return{success:!1,error:e.message}}}async refreshToken(e){try{const s=await this.request("/api/auth/refresh",{method:"POST",body:{refresh_token:e}});return this.setToken(s.access_token),{success:!0,data:s}}catch(s){return{success:!1,error:s.message}}}async searchRepositories(e,s={}){const t=new URLSearchParams({q:e,...s});return this.request(`/api/search/repositories?${t}`)}async searchUsers(e,s={}){const t=new URLSearchParams({q:e,...s});return this.request(`/api/search/users?${t}`)}async getTrending(e={}){const s=new URLSearchParams(e);return this.request(`/api/search/trending?${s}`)}async getSearchSuggestions(e,s={}){const t=new URLSearchParams({q:e,...s});return this.request(`/api/search/suggestions?${t}`)}async getSearchStats(){return this.request("/api/search/stats")}async getUserByUsername(e){return this.request(`/api/users/${e}`)}async getUserRepositoriesByUsername(e,s={}){const t=new URLSearchParams(s);return this.request(`/api/users/${e}/repositories?${t}`)}async getUserFollowers(e,s={}){const t=new URLSearchParams(s);return this.request(`/api/users/${e}/followers?${t}`)}async getUserFollowing(e,s={}){const t=new URLSearchParams(s);return this.request(`/api/users/${e}/following?${t}`)}async followUserByUsername(e){return this.request(`/api/users/${e}/follow`,{method:"POST"})}async unfollowUserByUsername(e){return this.request(`/api/users/${e}/follow`,{method:"DELETE"})}async getUserStatsByUsername(e){return this.request(`/api/users/${e}/stats`)}async getUserStarredRepositories(e,s={}){const t=new URLSearchParams;return Object.entries(s).forEach(([r,a])=>{a!=null&&a!==""&&t.append(r,a)}),this.request(`/api/users/${e}/starred?${t}`)}async getUserStorage(e){return this.request(`/api/users/${e}/storage`)}async listRepositories(e={}){const s=new URLSearchParams;for(const[t,r]of Object.entries(e))r!=null&&(Array.isArray(r)?r.forEach(a=>{a!=null&&s.append(t,a)}):s.append(t,r));return this.request(`/api/repositories/?${s}`)}async getRepository(e,s){return this.request(`/api/repositories/${e}/${s}`)}async createRepository(e){return this.request("/api/repositories",{method:"POST",body:e})}async createRepositoryWithReadme(e){return this.request("/api/repositories/with-readme",{method:"POST",body:e})}async updateRepository(e,s,t){return this.request(`/api/repositories/${e}/${s}`,{method:"PUT",body:t})}async deleteRepository(e,s){return this.request(`/api/repositories/${e}/${s}`,{method:"DELETE"})}async getRepositoryFiles(e,s,t=""){const r=new URLSearchParams({path:t});return this.request(`/api/repositories/${e}/${s}/files?${r}`)}async getRepositoryFileContent(e,s,t){return this.request(`/api/repositories/${e}/${s}/blob/${encodeURIComponent(t)}`)}async starRepository(e,s){return this.request(`/api/repositories/${e}/${s}/star`,{method:"POST"})}async unstarRepository(e,s){return this.request(`/api/repositories/${e}/${s}/star`,{method:"DELETE"})}async getRepositoryTrend(e,s,t={}){const r=new URLSearchParams,a=t.end_date||new Date().toISOString().split("T")[0],u=t.start_date||(()=>{const i=new Date;return i.setDate(i.getDate()-30),i.toISOString().split("T")[0]})();return r.append("start_date",u),r.append("end_date",a),r.append("interval",t.interval||"daily"),this.request(`/api/repositories/${e}/${s}/stats/trend?${r}`)}async getRepositoryStars(e,s,t={}){const r=new URLSearchParams(t);return this.request(`/api/repositories/${e}/${s}/stars?${r}`)}async getRepositoryStats(e,s){return this.request(`/api/repositories/${e}/${s}/stats`)}async incrementRepositoryView(e,s){return this.request(`/api/repositories/${e}/${s}/view`,{method:"POST"})}async checkUploadConflict(e,s,t){const r=encodeURIComponent(t);return this.request(`/api/repositories/${e}/${s}/check-upload?file_path=${r}`,{method:"POST"})}async uploadRepositoryFile(e,s,t,r={}){const{onProgress:a=null,confirmed:u=!1}=r,i=encodeURIComponent(t.name),h=u?"&confirmed=true":"";return this.uploadFile(`/api/repositories/${e}/${s}/upload?file_path=${i}${h}`,t,a)}async getDownloadUrl(e,s,t){const r=await fetch(`${this.baseUrl}/api/repositories/${e}/${s}/download/${t}`,{headers:{Authorization:`Bearer ${this.getToken()}`}});if(!r.ok)throw new Error(`Download failed: ${r.status}`);return r.json()}async deleteFile(e){return this.request(`/api/files/${e}`,{method:"DELETE"})}async getRepositoryServices(e,s,t={}){const r=new URLSearchParams;return Object.entries(t).forEach(([a,u])=>{u!=null&&u!==""&&r.append(a,u)}),this.request(`/api/services/servicelists/${e}/${s}?${r}`)}async createService(e,s,t,r=null){return t instanceof FormData?this.uploadFormData(`/api/services/${e}/${s}/create_service_from_image`,t,r):this.request(`/api/services/${e}/${s}/create_service_from_image`,{method:"POST",body:t})}async createServiceWithDockerTar(e,s,t,r=null){return this.uploadFormData(`/api/services/${e}/${s}/create_service_with_docker_tar`,t,r)}async getService(e){return this.request(`/api/services/${e}`)}async updateService(e,s){return this.request(`/api/services/${e}`,{method:"PUT",body:s})}async deleteService(e){return this.request(`/api/services/${e}`,{method:"DELETE"})}async startService(e,s={force_restart:!1}){return this.request(`/api/services/${e}/start`,{method:"POST",body:s})}async stopService(e,s={}){return this.request(`/api/services/${e}/stop`,{method:"POST",body:s})}async restartService(e){return this.request(`/api/services/${e}/restart`,{method:"POST"})}async getServiceStatus(e){return this.request(`/api/services/${e}/status`)}async getServiceLogs(e,s={}){const t=new URLSearchParams;return Object.entries(s).forEach(([r,a])=>{a!=null&&a!==""&&t.append(r,a)}),this.request(`/api/services/${e}/logs?${t}`)}async getServiceHealth(e){return this.request(`/api/services/${e}/health`)}async triggerHealthCheck(e){return this.request(`/api/services/${e}/health-check`,{method:"POST"})}async getServiceMetrics(e){return this.request(`/api/services/${e}/metrics`)}async getServiceResourceUsage(e){return this.request(`/api/services/${e}/resource-usage`)}async getServiceDemo(e){return this.request(`/api/services/${e}/demo`)}async generateAccessToken(e,s){return this.request(`/api/services/${e}/access-token`,{method:"POST",body:s})}async updateServiceVisibility(e,s){return this.request(`/api/services/${e}/visibility`,{method:"PUT",body:s})}async updateServiceFiles(e,s){return this.request(`/api/services/${e}/files/update`,{method:"POST",body:s})}async getServiceContainerInfo(e){return this.request(`/api/services/${e}/container-info`)}async validateServiceEnvironment(e){return this.request(`/api/services/${e}/validate-environment`,{method:"POST"})}async batchStartServices(e,s,t){return this.request(`/api/services/${e}/${s}/batch/start`,{method:"POST",body:{service_ids:t}})}async batchStopServices(e,s,t){return this.request(`/api/services/${e}/${s}/batch/stop`,{method:"POST",body:{service_ids:t}})}async batchDeleteServices(e,s,t){return this.request(`/api/services/${e}/${s}/batch`,{method:"DELETE",body:{service_ids:t}})}async getServicesHealthSummary(){return this.request("/api/services/health-summary")}async getServiceStatistics(){return this.request("/api/services/admin/statistics")}async getServicesOverview(){return this.request("/api/services/admin/overview")}async performSystemMaintenance(e={}){return this.request("/api/services/admin/maintenance",{method:"POST",body:e})}async getRepositoryImages(e){return this.request(`/api/images/repositories/${e}`)}async uploadImage(e,s,t=null){return this.uploadFormData(`/api/images/repositories/${e}/upload`,s,t)}async deleteImage(e,s=!1){return this.request(`/api/images/${e}?force=${s}`,{method:"DELETE"})}async getImageServices(e){return this.request(`/api/images/${e}/services`)}async createServiceFromImage(e,s){return this.request(`/api/images/${e}/services/create`,{method:"POST",body:s})}async getImageBuildLogs(e,s=100){return this.request(`/api/images/${e}/build-logs?limit=${s}`)}async getNotifications(e={}){const s=new URLSearchParams;return Object.entries(e).forEach(([t,r])=>{r!=null&&r!==""&&s.append(t,r)}),this.request(`/api/notifications?${s}`)}async getUnreadNotificationsCount(){return this.request("/api/notifications/unread/count")}async markNotificationAsRead(e){return this.request(`/api/notifications/${e}/read`,{method:"POST"})}async markAllNotificationsAsRead(){return this.request("/api/notifications/read-all",{method:"POST"})}async deleteNotification(e){return this.request(`/api/notifications/${e}`,{method:"DELETE"})}async getComments(e,s,t={}){const r=new URLSearchParams;return Object.entries(t).forEach(([a,u])=>{u!=null&&u!==""&&r.append(a,u)}),this.request(`/api/comments/${e}/${s}?${r}`)}async createComment(e,s,t){return this.request(`/api/comments/${e}/${s}`,{method:"POST",body:t})}async updateComment(e,s){return this.request(`/api/comments/${e}`,{method:"PUT",body:s})}async deleteComment(e){return this.request(`/api/comments/${e}`,{method:"DELETE"})}async likeComment(e){return this.request(`/api/comments/${e}/like`,{method:"POST"})}async unlikeComment(e){return this.request(`/api/comments/${e}/like`,{method:"DELETE"})}async getActivities(e={}){const s=new URLSearchParams;return Object.entries(e).forEach(([t,r])=>{r!=null&&r!==""&&s.append(t,r)}),this.request(`/api/activities?${s}`)}async getClassificationTree(){return this.request("/api/classifications/tree")}async updateFileContent(e,s,t,r,a){return this.request(`/api/repositories/${e}/${s}/blob/${t}`,{method:"PUT",body:{content:r,commit_message:a}})}async renameRepositoryFile(e,s,t,r,a){return this.request(`/api/repositories/${e}/${s}/files/rename`,{method:"POST",body:{old_path:t,new_filename:r,commit_message:a}})}async getAdminDashboard(){return this.request("/api/admin/dashboard")}async getAdminUsers(e={}){const s=new URLSearchParams;return Object.entries(e).forEach(([t,r])=>{r!=null&&r!==""&&s.append(t,r)}),this.request(`/api/admin/users?${s}`)}async updateAdminUserStatus(e,s){const t=new URLSearchParams;return Object.entries(s).forEach(([r,a])=>{a!=null&&t.append(r,a)}),this.request(`/api/admin/users/${e}/status?${t}`,{method:"PUT"})}async getAdminRepositories(e={}){const s=new URLSearchParams;return Object.entries(e).forEach(([t,r])=>{r!=null&&r!==""&&s.append(t,r)}),this.request(`/api/admin/repositories?${s}`)}async getAdminRepositoryStats(){return this.request("/api/admin/repositories/stats")}async updateAdminRepositoryStatus(e,s){const t=new URLSearchParams;return Object.entries(s).forEach(([r,a])=>{a!=null&&t.append(r,a)}),this.request(`/api/admin/repositories/${e}/status?${t}`,{method:"PUT"})}async restoreAdminRepository(e){return this.request(`/api/admin/repositories/${e}/restore`,{method:"POST"})}async hardDeleteAdminRepository(e,s=!1){return this.request(`/api/admin/repositories/${e}/hard-delete?confirm=${s}`,{method:"DELETE"})}async getAdminStorageStats(){return this.request("/api/admin/storage/stats")}async performAdminStorageCleanup(e={}){const s=new URLSearchParams;return Object.entries(e).forEach(([t,r])=>{r!=null&&s.append(t,r)}),this.request(`/api/admin/storage/cleanup?${s}`,{method:"POST"})}async getAdminSystemHealth(){return this.request("/api/admin/system/health")}async getAdminSystemLogs(e={}){const s=new URLSearchParams;return Object.entries(e).forEach(([t,r])=>{r!=null&&r!==""&&s.append(t,r)}),this.request(`/api/admin/logs?${s}`)}async getAdminSystemConfig(){return this.request("/api/admin/system/config")}async getAdminSystemInfo(){return this.request("/api/admin/system/info")}async updateAdminSystemConfig(e){return this.request("/api/admin/system/config",{method:"PUT",body:e})}async setAdminMaintenanceMode(e,s=""){return this.request("/api/admin/system/maintenance",{method:"POST",body:{enabled:e,message:s}})}}const P=new L,w=Object.freeze(Object.defineProperty({__proto__:null,api:P},Symbol.toStringTag,{value:"Module"}));export{T as E,P as a,w as b,A as g};
